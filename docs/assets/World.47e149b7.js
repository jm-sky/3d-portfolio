import{E as e,V as t,d as o,e as i,f as n,a,P as s,M as r,F as c,g as l,h,m as u,G as d,i as m,U as p,B as v,j as f,k as _,l as g,n as w,o as y,W as x,_ as P,p as k,q as b,r as S,R as C,s as M,c as E,t as z,u as L,D,A as F}from"./math.53cd6d09.js";import{o as N,c as T,a as R}from"./vendor.31155e9d.js";var A=function(o,i){void 0===i&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),i=document.body),this.domElement=i,this.isLocked=!1;var n,a=this,s={type:"change"},r={type:"lock"},c={type:"unlock"},l=new e(0,0,0,"YXZ"),h=Math.PI/2,u=new t;function d(e){if(!1!==a.isLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;l.setFromQuaternion(o.quaternion),l.y-=.002*t,l.x-=.002*i,l.x=Math.max(-h,Math.min(h,l.x)),o.quaternion.setFromEuler(l),a.dispatchEvent(s)}}function m(){document.pointerLockElement===a.domElement?(a.dispatchEvent(r),a.isLocked=!0):(a.dispatchEvent(c),a.isLocked=!1)}function p(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){document.addEventListener("mousemove",d,!1),document.addEventListener("pointerlockchange",m,!1),document.addEventListener("pointerlockerror",p,!1)},this.disconnect=function(){document.removeEventListener("mousemove",d,!1),document.removeEventListener("pointerlockchange",m,!1),document.removeEventListener("pointerlockerror",p,!1)},this.dispose=function(){this.disconnect()},this.getObject=function(){return o},this.getDirection=(n=new t(0,0,-1),function(e){return e.copy(n).applyQuaternion(o.quaternion)}),this.moveForward=function(e){u.setFromMatrixColumn(o.matrix,0),u.crossVectors(o.up,u),o.position.addScaledVector(u,e)},this.moveRight=function(e){u.setFromMatrixColumn(o.matrix,0),o.position.addScaledVector(u,e)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){document.exitPointerLock()},this.connect()};(A.prototype=Object.create(o.prototype)).constructor=A;const B={FPSControls:class{constructor(e){this._params=e,this._cells=e.cells,this._Init(e)}_Init(e){this._targetSelector=e._targetSelector||"#canvas",this._radius=2,this._enabled=!1,this._move={forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1},this._standing=!0,this._velocity=new t(0,0,0),this._decceleration=new t(-10,-10,-10),this._acceleration=new t(250,100,250),this._SetupPointerLock(),this._controls=new A(e.camera,document.body),e.scene.add(this._controls.getObject()),document.addEventListener("keydown",(e=>this._onKeyDown(e)),!1),document.addEventListener("keyup",(e=>this._onKeyUp(e)),!1),this._params._guiParams.camera={acceleration_x:250},this._params._gui.addFolder("Camera.FPS").add(this._params._guiParams.camera,"acceleration_x",50,25e3).onChange((()=>{const e=this._params._guiParams.camera.acceleration_x;this._acceleration.set(e,e,e)}))}_onKeyDown(e){switch(e.keyCode){case 38:case 87:this._move.forward=!0;break;case 37:case 65:this._move.left=!0;break;case 40:case 83:this._move.backward=!0;break;case 39:case 68:this._move.right=!0;break;case 33:this._move.up=!0;break;case 34:this._move.down=!0}}_onKeyUp(e){switch(e.keyCode){case 38:case 87:this._move.forward=!1;break;case 37:case 65:this._move.left=!1;break;case 40:case 83:this._move.backward=!1;break;case 39:case 68:this._move.right=!1;break;case 33:this._move.up=!1;break;case 34:this._move.down=!1}}_SetupPointerLock(){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){const e=e=>{document.pointerLockElement===document.body||document.mozPointerLockElement===document.body||document.webkitPointerLockElement===document.body?(this._enabled=!0,this._controls.enabled=!0):this._controls.enabled=!1},t=e=>{console.log(e)};document.addEventListener("pointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("pointerlockerror",t,!1),document.addEventListener("mozpointerlockerror",t,!1),document.addEventListener("webkitpointerlockerror",t,!1),document.querySelector(this._targetSelector).addEventListener("click",(e=>{if(document.body.requestPointerLock=document.body.requestPointerLock||document.body.mozRequestPointerLock||document.body.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){const e=t=>{document.fullscreenElement!==document.body&&document.mozFullscreenElement!==document.body&&document.mozFullScreenElement!==document.body||(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.body.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.body.requestFullscreen=document.body.requestFullscreen||document.body.mozRequestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullscreen;try{document.body.requestFullscreen()}catch(t){console.warn(t)}}else document.body.requestPointerLock()}),!1)}}_FindIntersections(e,t){const o=new i(t,this._radius);return e.filter((e=>o.intersectsBox(e)))}update(e){let o=.001*e;if(!this._enabled)return;const i=new t(this._velocity.x*this._decceleration.x,this._velocity.y*this._decceleration.y,this._velocity.z*this._decceleration.z);i.multiplyScalar(o),this._velocity.add(i),this._move.forward&&(this._velocity.z-=this._acceleration.z*o),this._move.backward&&(this._velocity.z+=this._acceleration.z*o),this._move.left&&(this._velocity.x-=this._acceleration.x*o),this._move.right&&(this._velocity.x+=this._acceleration.x*o),this._move.up&&(this._velocity.y+=this._acceleration.y*o),this._move.down&&(this._velocity.y-=this._acceleration.y*o);const n=this._controls.getObject(),a=new t;a.copy(n.position);const s=new t(0,0,1);s.applyQuaternion(n.quaternion),s.y=0,s.normalize();const r=new t(0,1,0),c=new t(1,0,0);c.applyQuaternion(n.quaternion),c.normalize(),c.multiplyScalar(this._velocity.x*o),r.multiplyScalar(this._velocity.y*o),s.multiplyScalar(this._velocity.z*o),n.position.add(s),n.position.add(c),n.position.add(r),a.copy(n.position)}}},j={CubicHermiteSpline:class{constructor(e){this._points=[],this._lerp=e}AddPoint(e,t){this._points.push([e,t])}Get(e){let t=0;for(let a=0;a<this._points.length&&!(this._points[a][0]>=e);a++)t=a;const o=Math.max(0,t-1),i=Math.min(this._points.length-1,t+1),n=Math.min(this._points.length-1,t+2);return t==i?this._points[t][1]:this._lerp((e-this._points[t][0])/(this._points[i][0]-this._points[t][0]),this._points[o][1],this._points[t][1],this._points[i][1],this._points[n][1])}},LinearSpline:class{constructor(e){this._points=[],this._lerp=e}AddPoint(e,t){this._points.push([e,t])}Get(e){let t=0;for(let i=0;i<this._points.length&&!(this._points[i][0]>=e);i++)t=i;const o=Math.min(this._points.length-1,t+1);return t==o?this._points[t][1]:this._lerp((e-this._points[t][0])/(this._points[o][0]-this._points[t][0]),this._points[t][1],this._points[o][1])}}};new n(8421504);const I=new n(14275986);new n(14275986);const q=new n(16777215);new n(5218063),new n(2856462);const G=new n(2736384);class W{constructor(e){this.width=e.width||10,this.scale=e.scale||1,this.segments=e.segments||256,this._params=e,this.init()}init(){const e=new t(this.width*this.scale,0,this.width*this.scale);this._plane=new a(new s(e.x,e.z,this.segments,this.segments),new r({wireframe:!1,color:7855530,side:c,vertexColors:l})),this._plane.castShadow=!1,this._plane.receiveShadow=!0,this._plane.position.add(this._params.offset),this._params.group.add(this._plane);const o=(e,t,o)=>t.clone().lerpHSL(o,e);this._colourSpline=[new j.LinearSpline(o),new j.LinearSpline(o)],this._colourSpline[0].AddPoint(0,new n(12035709)),this._colourSpline[0].AddPoint(.5,new n(15851964)),this._colourSpline[0].AddPoint(1,q),this._colourSpline[1].AddPoint(0,G),this._colourSpline[1].AddPoint(.5,new n(13559196)),this._colourSpline[1].AddPoint(1,q),this.rebuild()}_chooseColour(e,t,o){const i=this._params.biomeGenerator.Get(e,o),n=t/100;if(n<.05)return I;const a=this._colourSpline[0].Get(n),s=this._colourSpline[1].Get(n);return a.lerpHSL(s,i)}rebuild(){const e=[],t=this._params.offset;for(let o of this._plane.geometry.vertices){const i=[];let n=0;o.z=0;for(let e of this._params.heightGenerators)i.push(e.Get(o.x+t.x,o.y+t.y)),n+=i[i.length-1][1];if(n>0)for(let e of i)o.z+=e[0]*e[1]/n;e.push(this._chooseColour(o.x+t.x,o.z,o.y+t.y))}for(let o of this._plane.geometry.faces){const t=[o.a,o.b,o.c],i=[];for(let o of t)i.push(e[o]);o.vertexColors=i}this._plane.geometry.elementsNeedUpdate=!0,this._plane.geometry.verticesNeedUpdate=!0,this._plane.geometry.computeVertexNormals()}}const U={_GetPixel:function(e,t,o){const i=4*(t+e.width*o),n=e.data;return{r:n[i],g:n[i+1],b:n[i+2],a:n[i+3]}},_GetImageData:function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");return o.drawImage(e,0,0),o.getImageData(0,0,e.width,e.height)}};class O{constructor(e,t){this._params=e,this._data=U._GetImageData(t)}Get(e,t){const o=(e,t)=>{const o=4*(e+this._data.width*t);return this._data.data[o]/255},i=new h(-250,-250),n=new h(500,500),a=1-math.sat((e-i.x)/n.x),s=math.sat((t-i.y)/n.y),r=this._data.width-1,c=this._data.height-1,l=Math.floor(a*r),u=Math.floor(s*c),d=math.clamp(l+1,0,r),m=math.clamp(u+1,0,c),p=a*r-l,v=s*c-u,f=o(l,u),_=o(d,u),g=o(l,m),w=o(d,m),y=math.lerp(p,f,_),x=math.lerp(p,g,w);return math.lerp(v,y,x)*this._params.height}}class V{constructor(e,t,o,i){this._position=t.clone(),this._radius=[o,i],this._generator=e}Get(e,t){const o=this._position.distanceTo(new h(e,t));let i=1-u.sat((o-this._radius[0])/(this._radius[1]-this._radius[0]));return i=i*i*(3-2*i),i=i||1,[this._generator.Get(e,t),i]}}function H(e){return e*e*e*(e*(6*e-15)+10)}function X(e,t,o){return t+e*(o-t)}!function(){var e=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,o=1/6,i=(Math.sqrt(5)-1)/4,n=(5-Math.sqrt(5))/20;function a(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,o=0,i=1,n=r();e=n(" "),t=n(" "),o=n(" ");for(var a=0;a<arguments.length;a++)(e-=n(arguments[a]))<0&&(e+=1),(t-=n(arguments[a]))<0&&(t+=1),(o-=n(arguments[a]))<0&&(o+=1);return n=null,function(){var n=2091639*e+2.3283064365386963e-10*i;return e=t,t=o,o=n-(i=0|n)}}(e):Math.random,this.p=s(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}function s(e){var t,o=new Uint8Array(256);for(t=0;t<256;t++)o[t]=t;for(t=0;t<255;t++){var i=t+~~(e()*(256-t)),n=o[t];o[t]=o[i],o[i]=n}return o}function r(){var e=4022871197;return function(t){t=t.toString();for(var o=0;o<t.length;o++){var i=.02519603282416938*(e+=t.charCodeAt(o));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)}}a.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(o,i){var n,a,s=this.permMod12,r=this.perm,c=this.grad3,l=0,h=0,u=0,d=(o+i)*e,m=Math.floor(o+d),p=Math.floor(i+d),v=(m+p)*t,f=o-(m-v),_=i-(p-v);f>_?(n=1,a=0):(n=0,a=1);var g=f-n+t,w=_-a+t,y=f-1+2*t,x=_-1+2*t,P=255&m,k=255&p,b=.5-f*f-_*_;if(b>=0){var S=3*s[P+r[k]];l=(b*=b)*b*(c[S]*f+c[S+1]*_)}var C=.5-g*g-w*w;if(C>=0){var M=3*s[P+n+r[k+a]];h=(C*=C)*C*(c[M]*g+c[M+1]*w)}var E=.5-y*y-x*x;if(E>=0){var z=3*s[P+1+r[k+1]];u=(E*=E)*E*(c[z]*y+c[z+1]*x)}return 70*(l+h+u)},noise3D:function(e,t,i){var n,a,s,r,c,l,h,u,d,m,p=this.permMod12,v=this.perm,f=this.grad3,_=.3333333333333333*(e+t+i),g=Math.floor(e+_),w=Math.floor(t+_),y=Math.floor(i+_),x=(g+w+y)*o,P=e-(g-x),k=t-(w-x),b=i-(y-x);P>=k?k>=b?(c=1,l=0,h=0,u=1,d=1,m=0):P>=b?(c=1,l=0,h=0,u=1,d=0,m=1):(c=0,l=0,h=1,u=1,d=0,m=1):k<b?(c=0,l=0,h=1,u=0,d=1,m=1):P<b?(c=0,l=1,h=0,u=0,d=1,m=1):(c=0,l=1,h=0,u=1,d=1,m=0);var S=P-c+o,C=k-l+o,M=b-h+o,E=P-u+2*o,z=k-d+2*o,L=b-m+2*o,D=P-1+.5,F=k-1+.5,N=b-1+.5,T=255&g,R=255&w,A=255&y,B=.6-P*P-k*k-b*b;if(B<0)n=0;else{var j=3*p[T+v[R+v[A]]];n=(B*=B)*B*(f[j]*P+f[j+1]*k+f[j+2]*b)}var I=.6-S*S-C*C-M*M;if(I<0)a=0;else{var q=3*p[T+c+v[R+l+v[A+h]]];a=(I*=I)*I*(f[q]*S+f[q+1]*C+f[q+2]*M)}var G=.6-E*E-z*z-L*L;if(G<0)s=0;else{var W=3*p[T+u+v[R+d+v[A+m]]];s=(G*=G)*G*(f[W]*E+f[W+1]*z+f[W+2]*L)}var U=.6-D*D-F*F-N*N;if(U<0)r=0;else{var O=3*p[T+1+v[R+1+v[A+1]]];r=(U*=U)*U*(f[O]*D+f[O+1]*F+f[O+2]*N)}return 32*(n+a+s+r)},noise4D:function(e,t,o,a){var s,r,c,l,h,u,d,m,p,v,f,_,g,w,y,x,P,k=this.perm,b=this.grad4,S=(e+t+o+a)*i,C=Math.floor(e+S),M=Math.floor(t+S),E=Math.floor(o+S),z=Math.floor(a+S),L=(C+M+E+z)*n,D=e-(C-L),F=t-(M-L),N=o-(E-L),T=a-(z-L),R=0,A=0,B=0,j=0;D>F?R++:A++,D>N?R++:B++,D>T?R++:j++,F>N?A++:B++,F>T?A++:j++,N>T?B++:j++;var I=D-(u=R>=3?1:0)+n,q=F-(d=A>=3?1:0)+n,G=N-(m=B>=3?1:0)+n,W=T-(p=j>=3?1:0)+n,U=D-(v=R>=2?1:0)+2*n,O=F-(f=A>=2?1:0)+2*n,V=N-(_=B>=2?1:0)+2*n,H=T-(g=j>=2?1:0)+2*n,X=D-(w=R>=1?1:0)+3*n,Z=F-(y=A>=1?1:0)+3*n,K=N-(x=B>=1?1:0)+3*n,Y=T-(P=j>=1?1:0)+3*n,$=D-1+4*n,Q=F-1+4*n,J=N-1+4*n,ee=T-1+4*n,te=255&C,oe=255&M,ie=255&E,ne=255&z,ae=.6-D*D-F*F-N*N-T*T;if(ae<0)s=0;else{var se=k[te+k[oe+k[ie+k[ne]]]]%32*4;s=(ae*=ae)*ae*(b[se]*D+b[se+1]*F+b[se+2]*N+b[se+3]*T)}var re=.6-I*I-q*q-G*G-W*W;if(re<0)r=0;else{var ce=k[te+u+k[oe+d+k[ie+m+k[ne+p]]]]%32*4;r=(re*=re)*re*(b[ce]*I+b[ce+1]*q+b[ce+2]*G+b[ce+3]*W)}var le=.6-U*U-O*O-V*V-H*H;if(le<0)c=0;else{var he=k[te+v+k[oe+f+k[ie+_+k[ne+g]]]]%32*4;c=(le*=le)*le*(b[he]*U+b[he+1]*O+b[he+2]*V+b[he+3]*H)}var ue=.6-X*X-Z*Z-K*K-Y*Y;if(ue<0)l=0;else{var de=k[te+w+k[oe+y+k[ie+x+k[ne+P]]]]%32*4;l=(ue*=ue)*ue*(b[de]*X+b[de+1]*Z+b[de+2]*K+b[de+3]*Y)}var me=.6-$*$-Q*Q-J*J-ee*ee;if(me<0)h=0;else{var pe=k[te+1+k[oe+1+k[ie+1+k[ne+1]]]]%32*4;h=(me*=me)*me*(b[pe]*$+b[pe+1]*Q+b[pe+2]*J+b[pe+3]*ee)}return 27*(s+r+c+l+h)}},a._buildPermutationTable=s,"undefined"!=typeof define&&define.amd&&define((function(){return a})),"undefined"!=typeof exports?exports.SimplexNoise=a:"undefined"!=typeof window&&(window.SimplexNoise=a),"undefined"!=typeof module&&(module.exports=a)}();const Z=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];function K(e,t){let o=15&e,i=1+(7&o);return 8&o&&(i=-i),i*t}function Y(e,t,o){let i=7&e,n=i<4?t:o,a=i<4?o:t;return(1&i?-n:n)+(2&i?-2*a:2*a)}function $(e,t,o,i){let n=15&e,a=n<8?t:o,s=n<4?o:12==n||14==n?t:i;return(1&n?-a:a)+(2&n?-s:s)}function Q(e,t,o,i,n){let a=31&e,s=a<24?t:o,r=a<16?o:i,c=a<8?i:n;return(1&a?-s:s)+(2&a?-r:r)+(4&a?-c:c)}function J(e){let t,o,i,n,a,s,r;return t=Math.floor(e),i=e-t,n=i-1,o=t+1&255,t&=255,a=H(i),s=K(Z[t],i),r=K(Z[o],n),ie(.188*X(a,s,r))}function ee(e,t){let o,i,n,a,s,r,c,l,h,u,d,m,p,v;return o=Math.floor(e),i=Math.floor(t),s=e-o,r=t-i,c=s-1,l=r-1,n=o+1&255,a=i+1&255,o&=255,i&=255,u=H(r),h=H(s),d=Y(Z[o+Z[i]],s,r),m=Y(Z[o+Z[a]],s,l),p=X(u,d,m),d=Y(Z[n+Z[i]],c,r),m=Y(Z[n+Z[a]],c,l),v=X(u,d,m),ie(.507*X(h,p,v))}function te(e,t,o){let i,n,a,s,r,c,l,h,u,d,m,p,v,f,_,g,w,y,x,P,k;return i=Math.floor(e),n=Math.floor(t),r=Math.floor(o),l=e-i,h=t-n,u=o-r,d=l-1,m=h-1,p=u-1,a=i+1&255,s=n+1&255,c=r+1&255,i&=255,n&=255,r&=255,_=H(u),f=H(h),v=H(l),g=$(Z[i+Z[n+Z[r]]],l,h,u),w=$(Z[i+Z[n+Z[c]]],l,h,p),y=X(_,g,w),g=$(Z[i+Z[s+Z[r]]],l,m,u),w=$(Z[i+Z[s+Z[c]]],l,m,p),x=X(_,g,w),P=X(f,y,x),g=$(Z[a+Z[n+Z[r]]],d,h,u),w=$(Z[a+Z[n+Z[c]]],d,h,p),y=X(_,g,w),g=$(Z[a+Z[s+Z[r]]],d,m,u),w=$(Z[a+Z[s+Z[c]]],d,m,p),x=X(_,g,w),k=X(f,y,x),ie(.936*X(v,P,k))}function oe(e,t,o,i){let n,a,s,r,c,l,h,u,d,m,p,v,f,_,g,w,y,x,P,k,b,S,C,M,E,z,L,D;return n=Math.floor(e),a=Math.floor(t),s=Math.floor(o),r=Math.floor(i),d=e-n,m=t-a,p=o-s,v=i-r,f=d-1,_=m-1,g=p-1,w=v-1,c=n+1&255,l=a+1&255,h=s+1&255,u=r+1&255,n&=255,a&=255,s&=255,r&=255,k=H(v),P=H(p),x=H(m),y=H(d),b=Q(Z[n+Z[a+Z[s+Z[r]]]],d,m,p,v),S=Q(Z[n+Z[a+Z[s+Z[u]]]],d,m,p,w),C=X(k,b,S),b=Q(Z[n+Z[a+Z[h+Z[r]]]],d,m,g,v),S=Q(Z[n+Z[a+Z[h+Z[u]]]],d,m,g,w),M=X(k,b,S),E=X(P,C,M),b=Q(Z[n+Z[l+Z[s+Z[r]]]],d,_,p,v),S=Q(Z[n+Z[l+Z[s+Z[u]]]],d,_,p,w),C=X(k,b,S),b=Q(Z[n+Z[l+Z[h+Z[r]]]],d,_,g,v),S=Q(Z[n+Z[l+Z[h+Z[u]]]],d,_,g,w),M=X(k,b,S),z=X(P,C,M),L=X(x,E,z),b=Q(Z[c+Z[a+Z[s+Z[r]]]],f,m,p,v),S=Q(Z[c+Z[a+Z[s+Z[u]]]],f,m,p,w),C=X(k,b,S),b=Q(Z[c+Z[a+Z[h+Z[r]]]],f,m,g,v),S=Q(Z[c+Z[a+Z[h+Z[u]]]],f,m,g,w),M=X(k,b,S),E=X(P,C,M),b=Q(Z[c+Z[l+Z[s+Z[r]]]],f,_,p,v),S=Q(Z[c+Z[l+Z[s+Z[u]]]],f,_,p,w),C=X(k,b,S),b=Q(Z[c+Z[l+Z[h+Z[r]]]],f,_,g,v),S=Q(Z[c+Z[l+Z[h+Z[u]]]],f,_,g,w),M=X(k,b,S),z=X(P,C,M),D=X(x,E,z),ie(.87*X(y,L,D))}function ie(e){return(1+e)/2}const ne=function(){class e{constructor(){}noise2D(e,t){return 2*function(e,t,o,i){switch(arguments.length){case 1:return J(e);case 2:return ee(e,t);case 3:return te(e,t,o);case 3:return oe(e,t,o,i)}}(e,t)-1}}class t{constructor(){this._values={}}_Rand(e,t){const o=e+"."+t;return o in this._values||(this._values[o]=2*Math.random()-1),this._values[o]}noise2D(e,t){const o=Math.floor(e),i=Math.floor(t),n=o+1,a=i+1,s=e-o,r=t-i,c=this._Rand(o,i),l=this._Rand(n,i),h=this._Rand(o,a),d=this._Rand(n,a),m=u.lerp(s,c,l),p=u.lerp(s,h,d);return u.lerp(r,m,p)}}return{Noise:class{constructor(e){this._params=e,this._Init()}_Init(){this._noise={simplex:new SimplexNoise(this._params.seed),perlin:new e,rand:new t}}Get(e,t){const o=e/this._params.scale,i=t/this._params.scale,n=this._noise[this._params.noiseType],a=2**-this._params.persistence;let s=1,r=1,c=0,l=0;for(let h=0;h<this._params.octaves;h++){l+=(.5*n.noise2D(o*r,i*r)+.5)*s,c+=s,s*=a,r*=this._params.lacunarity}return l/=c,Math.pow(l,this._params.exponentiation)*this._params.height}}}}();class ae{constructor(e={}){this._params=e,this._chunkSize=e.chunkSize||1e3,this.init(e)}init(e){this._initNoise(e),this._initBiomes(e),this._initTerrain(e),e.add(this)}_initNoise(e){e._guiParams.noise={octaves:6,persistence:.707,lacunarity:1.8,exponentiation:4.5,height:300,scale:800,noiseType:"simplex",seed:277945293654};const t=e._gui.addFolder("Terrain.Noise");t.add(e._guiParams.noise,"noiseType",["simplex","perlin","rand"]).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"scale",32,4096).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"octaves",1,20,1).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"persistence",.25,1).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"lacunarity",.01,4).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"exponentiation",.1,10).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"height",0,512).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.noise,"seed",0,99999999,1).onChange(this.onNoiseChanged.bind(this)),this._noise=new ne.Noise(e._guiParams.noise),e._guiParams.heightmap={height:16}}_initBiomes(e){e._guiParams.biomes={octaves:2,persistence:.5,lacunarity:2,exponentiation:3.9,scale:2048,noiseType:"simplex",seed:2,exponentiation:1,height:1};const t=e._gui.addFolder("Terrain.Biomes");t.add(e._guiParams.biomes,"scale",64,4096).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.biomes,"octaves",1,20,1).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.biomes,"persistence",.01,1).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.biomes,"lacunarity",.01,4).onChange(this.onNoiseChanged.bind(this)),t.add(e._guiParams.biomes,"exponentiation",.1,10).onChange(this.onNoiseChanged.bind(this)),this._biomes=new ne.Noise(e._guiParams.biomes)}_initTerrain(e){e._guiParams.terrain={wireframe:!1},this._chunks={},this._group=new d,this._group.rotation.x=-Math.PI/2,e.scene.add(this._group);for(let t=-0;t<=0;t++)for(let e=-0;e<=0;e++)this._addChunk(t,e);e._gui.addFolder("Terrain").add(e._guiParams.terrain,"wireframe").onChange((()=>{for(let t in this._chunks)this._chunks[t].chunk._plane.material.wireframe=e._guiParams.terrain.wireframe}))}onNoiseChanged(){for(let e in this._chunks)this._chunks[e].chunk.rebuild()}_key(e,t){return`${e}.${t}`}_addChunk(e,o){const i=new h(e*this._chunkSize,o*this._chunkSize),n=new W({group:this._group,offset:new t(i.x,i.y,0),scale:1,width:this._chunkSize,biomeGenerator:this._biomes,heightGenerators:[new V(this._noise,i,1e5,100001)]}),a=this._key(e,o),s=[];for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++)0!=t&&0!=i&&s.push(this._key(e+t,o+i));this._chunks[a]={chunk:n,edges:s}}SetHeightmap(e){const t=new V(new O(this._params._guiParams.heightmap,e),new h(0,0),250,300);for(let o in this._chunks)this._chunks[o].chunk._params.heightGenerators.unshift(t),this._chunks[o].chunk.rebuild()}update(e){}}var se=function(){var e=se.SkyShader,t=new m({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:p.clone(e.uniforms),side:v});a.call(this,new f(1,1,1),t)};se.prototype=Object.create(a.prototype),se.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new t},up:{value:new t(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var re=function(e,o){a.call(this,e);var i=this,s=void 0!==(o=o||{}).textureWidth?o.textureWidth:512,r=void 0!==o.textureHeight?o.textureHeight:512,l=void 0!==o.clipBias?o.clipBias:0,h=void 0!==o.alpha?o.alpha:1,u=void 0!==o.time?o.time:0,d=void 0!==o.waterNormals?o.waterNormals:null,v=void 0!==o.sunDirection?o.sunDirection:new t(.70707,.70707,0),f=new n(void 0!==o.sunColor?o.sunColor:16777215),M=new n(void 0!==o.waterColor?o.waterColor:8355711),E=void 0!==o.eye?o.eye:new t(0,0,0),z=void 0!==o.distortionScale?o.distortionScale:20,L=void 0!==o.side?o.side:c,D=void 0!==o.fog&&o.fog,F=new _,N=new t,T=new t,R=new t,A=new g,B=new t(0,0,-1),j=new w,I=new t,q=new t,G=new w,W=new g,U=new y,O=new x(s,r,{minFilter:S,magFilter:S,format:C,stencilBuffer:!1});P.isPowerOfTwo(s)&&P.isPowerOfTwo(r)||(O.texture.generateMipmaps=!1);var V={uniforms:p.merge([k.fog,k.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new g},sunColor:{value:new n(8355711)},sunDirection:{value:new t(.70707,.70707,0)},eye:{value:new t},waterColor:{value:new n(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",b.fog_pars_vertex,b.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",b.fog_vertex,b.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",b.common,b.packing,b.bsdfs,b.fog_pars_fragment,b.lights_pars_begin,b.shadowmap_pars_fragment,b.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",b.tonemapping_fragment,b.fog_fragment,"}"].join("\n")},H=new m({fragmentShader:V.fragmentShader,vertexShader:V.vertexShader,uniforms:p.clone(V.uniforms),transparent:!0,lights:!0,side:L,fog:D});H.uniforms.mirrorSampler.value=O.texture,H.uniforms.textureMatrix.value=W,H.uniforms.alpha.value=h,H.uniforms.time.value=u,H.uniforms.normalSampler.value=d,H.uniforms.sunColor.value=f,H.uniforms.waterColor.value=M,H.uniforms.sunDirection.value=v,H.uniforms.distortionScale.value=z,H.uniforms.eye.value=E,i.material=H,i.onBeforeRender=function(e,t,o){if(T.setFromMatrixPosition(i.matrixWorld),R.setFromMatrixPosition(o.matrixWorld),A.extractRotation(i.matrixWorld),N.set(0,0,1),N.applyMatrix4(A),I.subVectors(T,R),!(I.dot(N)>0)){I.reflect(N).negate(),I.add(T),A.extractRotation(o.matrixWorld),B.set(0,0,-1),B.applyMatrix4(A),B.add(R),q.subVectors(T,B),q.reflect(N).negate(),q.add(T),U.position.copy(I),U.up.set(0,1,0),U.up.applyMatrix4(A),U.up.reflect(N),U.lookAt(q),U.far=o.far,U.updateMatrixWorld(),U.projectionMatrix.copy(o.projectionMatrix),W.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),W.multiply(U.projectionMatrix),W.multiply(U.matrixWorldInverse),F.setFromNormalAndCoplanarPoint(N,T),F.applyMatrix4(U.matrixWorldInverse),j.set(F.normal.x,F.normal.y,F.normal.z,F.constant);var n=U.projectionMatrix;G.x=(Math.sign(j.x)+n.elements[8])/n.elements[0],G.y=(Math.sign(j.y)+n.elements[9])/n.elements[5],G.z=-1,G.w=(1+n.elements[10])/n.elements[14],j.multiplyScalar(2/j.dot(G)),n.elements[2]=j.x,n.elements[6]=j.y,n.elements[10]=j.z+1-l,n.elements[14]=j.w,E.setFromMatrixPosition(o.matrixWorld);var a=e.getRenderTarget(),s=e.xr.enabled,r=e.shadowMap.autoUpdate;i.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(O),e.clear(),e.render(t,U),i.visible=!0,e.xr.enabled=s,e.shadowMap.autoUpdate=r,e.setRenderTarget(a)}}};(re.prototype=Object.create(a.prototype)).constructor=re;class ce{constructor(e){this._params=e,this.size=(e.options.water||{}).size||5e3,this.segments=(e.options.water||{}).segments||100,this.init(e)}init(e){this._group=new d,this.mesh=this._group,this.createWater(),this.createSky(),e.add(this)}createSky(){const e=this._params;e._guiParams.sky={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1},e._guiParams.sun={inclination:.31,azimuth:.25};const o=()=>{for(let t in e._guiParams.sky)this._sky.material.uniforms[t].value=e._guiParams.sky[t];for(let t in e._guiParams.general)this._sky.material.uniforms[t].value=e._guiParams.general[t]},i=()=>{var o=Math.PI*(e._guiParams.sun.inclination-.5),i=2*Math.PI*(e._guiParams.sun.azimuth-.5);const n=new t;n.x=Math.cos(i),n.y=Math.sin(i)*Math.sin(o),n.z=Math.sin(i)*Math.cos(o),this._sky&&this._sky.material.uniforms.sunPosition.value.copy(n),this._water&&this._water.material.uniforms.sunDirection.value.copy(n.normalize())},n=this._params._gui.addFolder("Sky");n.add(e._guiParams.sky,"turbidity",.1,30).onChange(o),n.add(e._guiParams.sky,"rayleigh",.1,4).onChange(o),n.add(e._guiParams.sky,"mieCoefficient",1e-4,.1).onChange(o),n.add(e._guiParams.sky,"mieDirectionalG",0,1).onChange(o),n.add(e._guiParams.sky,"luminance",0,2).onChange(o);const a=this._params._gui.addFolder("Sun");a.add(e._guiParams.sun,"inclination",0,1).onChange(i),a.add(e._guiParams.sun,"azimuth",0,1).onChange(i),this._sky=new se,this._sky.scale.setScalar(this.size),this._group.add(this._sky),o(),i()}createWater(){const e=new M(this.size,this.size,this.segments,this.segments);this._water=new re(e,{textureWidth:2048,textureHeight:2048,waterNormals:(new E).load("./resources/waternormals.jpg",(e=>{e.wrapS=e.wrapT=z})),alpha:.5,sunDirection:new t(1,0,0),sunColor:16777215,waterColor:7695,distortionScale:0,fog:void 0}),this._water.rotation.x=-Math.PI/2,this._water.position.y=4,this._group.add(this._water)}update(e){let t=.001*e;this._water&&(this._water.material.uniforms.time.value+=t),this._group.position.x=this._params.camera.position.x,this._group.position.z=this._params.camera.position.z}}new E;class le{_key(e,t,o){return`${e}.${t}.${o}`}_cellIndex(e,t){return[Math.floor(e/this.size),Math.floor(t/this.size)]}constructor(){this.mesh=new d}_LoadBackground(){const e=(new L).load(["./resources/posx.jpg","./resources/posx.jpg","./resources/posy.jpg","./resources/negy.jpg","./resources/posx.jpg","./resources/posx.jpg"]);this.app.scene.background=e}attach(e){this.app=e,this.app.camera.position.setX(10),this.app.camera.position.setZ(10),this.app.camera.position.setY(220),this.app.add(this),this.terrainManager=new ae(e),this.environment=new ce(e);let t=new D(8421504,1,100);t.position.set(-100,100,-100),t.target.position.set(0,0,0),t.castShadow=!1,this.app.lights.directionalLight=t,this.app.scene.add(t),this.app.add(new B.FPSControls(e))}}const he={name:"World",data:()=>({app:null}),mounted(){const e=new F({helpers:!0}),t=new le;this.app=e,t.attach(e),e.render()},beforeUnmount(){this.app._gui&&this.app._gui.domElement.remove(),this.app._stats&&this.app._stats.domElement.remove()}},ue={id:"canvas-wrapper"},de=R("canvas",{id:"canvas"},null,-1);he.render=function(e,t,o,i,n,a){return N(),T("div",ue,[de])};export default he;
